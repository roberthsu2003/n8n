# Google_Cloud_api服務
## 訂便當系統

### 📚 工作流程說明

這個 n8n 工作流程建立了一個完整的線上訂便當系統。使用者可以透過網頁表單選擇便當種類，系統會自動將訂單資料整理後儲存到 Google 試算表中，方便您管理和統計便當訂單。

### 影片和template

[訂便當系統-樣版json檔](./訂便當.json)

### 預覽圖

![工作流程預覽](./images/workflow.png)

#### 📋 節點詳細說明

1. **📝 On form submission（表單提交觸發節點）**
   - **功能**：工作流程的觸發起點，自動建立一個網頁表單讓使用者填寫訂便當資訊
   - **表單標題**：訂便當系統
   - **表單說明**：中午的便當
   - **表單欄位**：
     - **姓名欄位**：
       - 欄位名稱：`姓名`
       - 標籤：請輸入姓名
       - 必填：是
       - 類型：文字輸入
     - **便當選擇欄位**：
       - 欄位名稱：`選擇便當類型`
       - 標籤：請選擇
       - 必填：是
       - 類型：下拉選單
       - 選項：
         - 火腿-120
         - 雞腿-130
         - 排骨-110
   - **送出按鈕文字**：送出
   - **為什麼需要它**：提供使用者友善的訂購介面，並自動觸發後續的資料處理流程
   - **如何使用**：點擊節點可以取得表單的專屬網址，分享給需要訂便當的人

2. **🔄 Edit Fields（編輯欄位節點）**
   - **功能**：將表單提交的資料重新整理成適合儲存的格式
   - **資料處理邏輯**：
     - **姓名**：直接從表單取得 `={{ $json['姓名'] }}`
     - **便當名稱**：從「選擇便當類型」欄位中分離出便當名稱
       - 使用表達式：`={{ $json['選擇便當類型'].split('-')[0] }}`
       - 範例：「火腿-120」→「火腿」
     - **價格**：從「選擇便當類型」欄位中提取價格並轉換為數字
       - 使用表達式：`={{ Number($json['選擇便當類型'].split('-')[1]) }}`
       - 範例：「火腿-120」→ 120
     - **時間**：從提交時間中提取日期部分
       - 使用表達式：`={{ $json.submittedAt.split('T')[0] }}`
       - 範例：「2024-01-20T14:30:00」→「2024-01-20」
   - **為什麼需要它**：
     - 將便當類型和價格分離，方便後續統計和計算
     - 格式化日期，讓試算表更整齊易讀
     - 確保資料類型正確（價格為數字型態）

3. **📊 Append row in sheet（Google 試算表新增列節點）**
   - **功能**：將處理好的訂單資料自動寫入 Google 試算表
   - **操作類型**：Append（在試算表末端新增一列）
   - **試算表連接**：需要連接您的 Google 帳號
   - **欄位對應**：
     - `客戶姓名` ← 表單的「姓名」
     - `便當名稱` ← 處理後的「便當名稱」（如：火腿）
     - `價格` ← 處理後的「價格」（如：120）
     - `訂購日期` ← 處理後的「時間」（如：2024-01-20）
   - **為什麼需要它**：
     - 自動建立訂單紀錄，無需手動輸入
     - 方便統計每日訂單數量和金額
     - 可以追蹤訂購歷史
   - **重要提醒**：
     - 使用前需要先連接 Google 帳號
     - 需要指定要寫入的試算表和工作表
     - 確保試算表的欄位名稱與設定一致

#### 🎯 學習重點

- **表單觸發**：了解如何使用 Form Trigger 建立網頁表單並接收使用者提交的資料
- **字串處理**：學習如何使用 `split()` 方法分割字串，提取需要的資料
- **資料型態轉換**：認識如何使用 `Number()` 將字串轉換為數字
- **日期時間處理**：學習如何從 ISO 8601 格式的時間戳記中提取日期
- **Google Sheets 整合**：了解如何將資料自動寫入 Google 試算表
- **n8n 表達式**：熟悉 n8n 的表達式語法 `={{ }}` 進行動態資料處理
- **工作流程設計**：理解資料收集、處理、儲存的完整自動化流程

#### 💡 實際應用場景

這個範例可以延伸應用到：
- **辦公室訂便當系統**：每天中午收集同事的訂單
- **活動報名表單**：收集參加者資料並自動建立名單
- **問卷調查系統**：收集問卷回覆並自動統計
- **客戶訂單系統**：接收產品訂單並建立訂單紀錄
- **預約系統**：收集預約資訊並自動排程
- **費用申請系統**：收集申請資料並自動記錄到試算表

#### ⚙️ 設定步驟

1. **匯入工作流程**：
   - 下載 `訂便當.json` 檔案
   - 在 n8n 中點選「Import from File」匯入工作流程

2. **設定 Google Sheets 連線**：
   - 雙擊「Append row in sheet」節點
   - 點選「Credential to connect with」
   - 選擇或新增 Google Sheets 憑證
   - 授權 n8n 存取您的 Google 試算表

3. **建立或選擇試算表**：
   - 在 Google Sheets 中建立新的試算表
   - 在第一列建立欄位標題：`客戶姓名`、`便當名稱`、`價格`、`訂購日期`
   - 在節點中選擇此試算表和工作表

4. **自訂表單內容**（選用）：
   - 雙擊「On form submission」節點
   - 修改表單標題和說明
   - 調整便當選項和價格
   - 新增或刪除表單欄位

5. **啟動工作流程**：
   - 點選右上角的「Active」開關啟動工作流程
   - 點擊「On form submission」節點
   - 複製「Production URL」分享給使用者

6. **測試工作流程**：
   - 點擊「Test URL」開啟測試表單
   - 填寫表單並送出
   - 檢查 Google 試算表是否正確新增資料

#### 📌 注意事項

- 工作流程必須處於「Active」狀態，表單才能接收訂單
- Google 試算表的欄位標題必須與節點設定一致
- 如果修改表單欄位，記得同步更新「Edit Fields」節點的對應設定
- 建議在正式使用前先用測試 URL 進行測試
- 可以在 Google 試算表中加入公式自動計算總金額

---