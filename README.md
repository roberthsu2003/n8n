# n8n 教學講義

## 關於 n8n

n8n 起初的名稱 nodemation 意指節點自動化，後簡化為 n8n 這種數字縮寫法。n8n 的核心定位是整合帶有 **API 的應用程式和服務**，並強調其 無程式碼（No Code） 或低程式碼的特性。

## n8n 工作流的五個核心邏輯要素

1. **觸發** - 啟動工作流的起點
2. **連接** - 連結不同的服務和應用程式
3. **資料處理** - 轉換和處理資料
4. **測試** - 驗證工作流是否正常運作
5. **啟動** - 執行自動化任務

---

## 目錄

- [第一章：n8n 簡介與安裝](#第一章n8n-簡介與安裝)
- [第二章：基礎概念與介面介紹](#第二章基礎概念與介面介紹)
- [第三章：建立第一個工作流](#第三章建立第一個工作流)
- [第四章：常用節點介紹](#第四章常用節點介紹)
- [第五章：資料處理與轉換](#第五章資料處理與轉換)
- [第六章：錯誤處理與調試](#第六章錯誤處理與調試)
- [第七章：進階技巧](#第七章進階技巧)
- [第八章：實用案例](#第八章實用案例)
- [第九章：部署與維護](#第九章部署與維護)

---

## 第一章：n8n 簡介與安裝

### 1.1 什麼是 n8n？

- n8n 是一個開源的自動化工作流工具
- 無程式碼/低程式碼平台
- 可整合多種 API 和服務

### 1.2 n8n 的應用場景

- 資料同步
- 通知提醒
- 資料處理
- API 整合
- 自動化任務

### 1.3 安裝方式

#### 方式一：使用 Docker

**window**

- 在n8n內連結本機電腦的網路使用`localhost`

```bash
docker volume create n8n_data

docker run -d \
 --name n8n \
 -p 5678:5678 \
 -v n8n_data:/home/node/.n8n \
 -e GENERIC_TIMEZONE="Asia/Taipei" \
 docker.n8n.io/n8nio/n8n
```

**Mac電腦**

- 在n8n內連結本機電腦的網路使用`host.docker.internal`

```bash
docker volume create n8n_data

docker run -d \
 --name n8n \
 -p 5678:5678 \
 -v n8n_data:/home/node/.n8n \
 -e GENERIC_TIMEZONE="Asia/Taipei" \
 docker.n8n.io/n8nio/n8n
```



#### 方式二：使用 npm

```bash
npm install n8n -g
n8n start
```

#### 方式三：使用 npx（快速測試）

```bash
npx n8n
```

### 1.4 初次啟動

- 瀏覽器訪問：`http://localhost:5678`
- 建立第一個帳號
- 熟悉初始介面

---

## 第二章：基礎概念與介面介紹

### 2.1 核心概念

#### 工作流（Workflow）
- 定義：一系列自動化步驟的集合
- 組成：由多個節點（Node）連接而成

#### 節點（Node）
- 定義：工作流中的基本執行單元
- 類型：觸發節點、執行節點、輸出節點

#### 連線（Connection）
- 定義：節點之間的資料流向
- 方向：從上游節點到下游節點

### 2.2 介面介紹

#### 主要區域
- **左側面板**：節點列表、工作流列表
- **中央畫布**：工作流編輯區域
- **右側面板**：節點設定面板
- **上方工具列**：執行、儲存、分享等功能

#### 節點面板分類
- **觸發節點**（Triggers）
- **動作節點**（Actions）
- **資料處理節點**（Data Processing）
- **流程控制節點**（Flow Control）

### 2.3 資料格式

- **JSON 格式**：n8n 使用 JSON 傳遞資料
- **資料結構**：每個節點輸出為陣列格式
- **資料項目**：每個陣列元素包含 JSON 物件

---

## 第三章：建立第一個工作流

### 3.1 建立新工作流

1. 點擊「New Workflow」
2. 命名工作流
3. 開始新增節點

### 3.2 第一個範例：簡單的 Webhook 回應

#### 步驟一：新增 Webhook 節點
- 從觸發節點中選擇「Webhook」
- 設定為「GET」或「POST」
- 點擊「Execute Node」取得 URL

#### 步驟二：新增回應節點
- 新增「Respond to Webhook」節點
- 連接到 Webhook 節點
- 設定回應內容

#### 步驟三：測試工作流
- 點擊「Execute Workflow」
- 使用瀏覽器或工具測試 Webhook URL

### 3.3 工作流執行模式

- **手動執行**：點擊執行按鈕
- **自動執行**：啟用工作流後自動觸發
- **排程執行**：使用 Cron 節點設定定時執行

---

## 第四章：常用節點介紹

### 4.1 觸發節點

#### Webhook
- 用途：接收 HTTP 請求
- 常用場景：接收外部系統的資料

#### Schedule Trigger
- 用途：定時觸發
- 常用場景：定期執行任務

#### Manual Trigger
- 用途：手動觸發
- 常用場景：測試工作流

### 4.2 HTTP 請求節點

#### HTTP Request
- 用途：發送 HTTP 請求
- 支援方法：GET、POST、PUT、DELETE 等
- 可設定 Headers、Body、認證

### 4.3 資料處理節點

#### Set
- 用途：設定資料欄位
- 可新增、修改、刪除欄位

#### Code
- 用途：執行 JavaScript 程式碼
- 適合複雜的資料處理邏輯

#### Function
- 用途：執行自訂函數
- 類似 Code 節點，但更靈活

### 4.4 流程控制節點

#### IF
- 用途：條件判斷
- 根據條件分流資料

#### Switch
- 用途：多重條件判斷
- 類似程式語言中的 switch-case

#### Merge
- 用途：合併多個資料流
- 支援多種合併模式

---

## 第五章：資料處理與轉換

### 5.1 資料表達式

#### 基本語法
- 使用 `{{ }}` 包圍表達式
- 範例：`{{ $json.name }}`

#### 常見用法
- 存取 JSON 資料：`{{ $json.field }}`
- 存取環境變數：`{{ $env.VARIABLE_NAME }}`
- 存取節點資料：`{{ $node["節點名稱"].json.field }}`

### 5.2 資料轉換技巧

#### 使用 Set 節點
- 重新命名欄位
- 新增計算欄位
- 組合多個欄位

#### 使用 Code 節點
- 複雜的資料轉換邏輯
- 陣列處理
- 資料驗證

### 5.3 陣列操作

#### 處理陣列資料
- 使用 Split In Batches 節點分批處理
- 使用 Loop Over Items 節點逐一處理

---

## 第六章：錯誤處理與調試

### 6.1 錯誤處理

#### Error Trigger
- 用途：捕獲工作流中的錯誤
- 可設定錯誤處理流程

#### Continue On Fail
- 用途：節點失敗時繼續執行
- 適合非關鍵性節點

### 6.2 調試技巧

#### 使用 Execute Workflow
- 手動執行測試
- 查看每個節點的輸出

#### 使用 Debug 節點
- 輸出特定資料
- 檢查資料格式

#### 查看執行歷史
- 在執行歷史中查看詳細資訊
- 檢查錯誤訊息

### 6.3 常見錯誤

#### 資料格式錯誤
- 檢查 JSON 格式
- 確認資料欄位名稱

#### 認證錯誤
- 檢查 API 金鑰
- 確認認證方式

---

## 第七章：進階技巧

### 7.1 變數與環境變數

#### 環境變數
- 設定敏感資訊
- 區分不同環境（開發、生產）

#### 工作流變數
- 在工作流中定義變數
- 重複使用常用值

### 7.2 子工作流

#### 使用 Execute Workflow 節點
- 呼叫其他工作流
- 傳遞參數
- 接收回傳值

### 7.3 認證設定

#### Credentials 管理
- 建立認證資訊
- 在工作流中重複使用
- 安全儲存敏感資料

### 7.4 工作流最佳實踐

- 命名規範
- 註解說明
- 模組化設計
- 錯誤處理

---

## 第八章：實用案例

### 8.1 案例一：資料同步

**需求**：定期將 A 系統的資料同步到 B 系統

**步驟**：
1. 使用 Schedule Trigger 定時觸發
2. 從 A 系統取得資料（HTTP Request）
3. 處理資料格式（Set/Code）
4. 寫入 B 系統（HTTP Request）

### 8.2 案例二：通知提醒

**需求**：當特定事件發生時發送通知

**步驟**：
1. 使用 Webhook 接收事件
2. 判斷是否符合條件（IF）
3. 發送通知（Email/Slack/Discord）

### 8.3 案例三：資料處理

**需求**：處理 CSV 資料並轉換格式

**步驟**：
1. 讀取 CSV 檔案（HTTP Request/Read Binary File）
2. 解析 CSV（Code 節點）
3. 轉換資料格式（Set/Code）
4. 輸出結果（Write to File/HTTP Request）

### 8.4 案例四：API 整合

**需求**：整合多個 API 服務

**步驟**：
1. 從第一個 API 取得資料
2. 處理資料
3. 呼叫第二個 API
4. 合併結果並輸出

---

## 第九章：部署與維護

### 9.1 部署方式

#### 自架伺服器
- 使用 Docker 部署
- 使用 Docker Compose 管理
- 設定持久化儲存

#### 雲端部署
- 部署到 VPS
- 使用雲端服務（AWS、GCP、Azure）

### 9.2 備份與還原

#### 匯出工作流
- 匯出為 JSON 格式
- 版本控制（Git）

#### 匯入工作流
- 從 JSON 匯入
- 從範本匯入

### 9.3 效能優化

- 批次處理資料
- 避免不必要的 API 呼叫
- 使用快取機制

### 9.4 監控與日誌

- 查看執行歷史
- 監控錯誤率
- 設定警示通知

---

## 附錄

### A. 常用節點清單

- **觸發節點**：Webhook、Schedule Trigger、Manual Trigger
- **HTTP 節點**：HTTP Request
- **資料處理**：Set、Code、Function、Split In Batches
- **流程控制**：IF、Switch、Merge
- **檔案處理**：Read Binary File、Write Binary File
- **通知節點**：Email、Slack、Discord

### B. 參考資源

- [n8n 官方文件](https://docs.n8n.io/)
- [n8n 社群論壇](https://community.n8n.io/)
- [n8n GitHub](https://github.com/n8n-io/n8n)
- [n8n 範本庫](https://n8n.io/workflows/)

### C. 常見問題 FAQ

#### Q: 如何處理大量資料？
A: 使用 Split In Batches 節點分批處理，避免記憶體問題。

#### Q: 如何設定排程？
A: 使用 Schedule Trigger 節點，支援 Cron 語法。

#### Q: 如何除錯工作流？
A: 使用 Execute Workflow 功能，查看每個節點的輸出資料。

---

## 更新日誌

- **2024-XX-XX**：初始版本建立

---

## 授權

本教學講義採用 MIT 授權。
