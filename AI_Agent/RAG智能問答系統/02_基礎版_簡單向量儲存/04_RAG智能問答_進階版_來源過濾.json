{
  "name": "04_RAGæ™ºèƒ½å•ç­”_é€²éšç‰ˆ_ä¾†æºéæ¿¾",
  "nodes": [
    {
      "parameters": {
        "options": {
          "allowFileUploads": false,
          "subtitle": "ğŸ’¬ æ™ºèƒ½å•ç­”ç³»çµ± (é€²éšç‰ˆ)\n\nâœ¨ åŠŸèƒ½ç‰¹è‰²:\nğŸ¯ å¯æŒ‡å®šæŸ¥è©¢ä¾†æº\nğŸ“š å¤šè¼ªå°è©±è¨˜æ†¶\nğŸ” æ™ºèƒ½é—œéµå­—è­˜åˆ¥\n\nğŸ’¡ ä½¿ç”¨æç¤º:\nâ€¢ ç›´æ¥æå• â†’ æœå°‹æ‰€æœ‰æ–‡ä»¶\nâ€¢ \"å¾æœ¬æ©Ÿæª”æ¡ˆæŸ¥è©¢...\" â†’ åªæœå°‹ä¸Šå‚³çš„æª”æ¡ˆ\nâ€¢ \"å¾ Google Drive æŸ¥è©¢...\" â†’ åªæœå°‹é›²ç«¯æª”æ¡ˆ"
        }
      },
      "id": "chat-trigger-201",
      "name": "ğŸ’¬ Chat Trigger",
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [240, 400],
      "webhookId": "rag-chat-advanced"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "parse-01",
              "name": "user_question",
              "value": "={{ $json.chatInput }}",
              "type": "string"
            },
            {
              "id": "parse-02",
              "name": "source_filter",
              "value": "={{ $json.chatInput.toLowerCase().includes('æœ¬æ©Ÿ') || $json.chatInput.toLowerCase().includes('æœ¬åœ°') || $json.chatInput.toLowerCase().includes('ä¸Šå‚³') || $json.chatInput.toLowerCase().includes('local') ? 'local_upload' : $json.chatInput.toLowerCase().includes('google') || $json.chatInput.toLowerCase().includes('drive') || $json.chatInput.toLowerCase().includes('é›²ç«¯') || $json.chatInput.toLowerCase().includes('gdrive') ? 'google_drive' : 'all' }}",
              "type": "string"
            },
            {
              "id": "parse-03",
              "name": "clean_question",
              "value": "={{ $json.chatInput.replace(/å¾æœ¬æ©Ÿæª”æ¡ˆä¸­|å¾æœ¬åœ°æª”æ¡ˆä¸­|å¾ä¸Šå‚³çš„æª”æ¡ˆä¸­|å¾æœ¬æ©Ÿæª”æ¡ˆ|å¾æœ¬åœ°æª”æ¡ˆ|å¾æœ¬æ©Ÿ|å¾æœ¬åœ°|å¾Google Driveä¸­|å¾Google Drive|å¾é›²ç«¯ä¸­|å¾é›²ç«¯|æŸ¥è©¢|æœå°‹|æ‰¾ä¸€ä¸‹|æ‰¾æ‰¾çœ‹|å¹«æˆ‘æ‰¾/g, '').trim() }}",
              "type": "string"
            },
            {
              "id": "parse-04",
              "name": "has_source_filter",
              "value": "={{ $json.chatInput.toLowerCase().includes('æœ¬æ©Ÿ') || $json.chatInput.toLowerCase().includes('æœ¬åœ°') || $json.chatInput.toLowerCase().includes('ä¸Šå‚³') || $json.chatInput.toLowerCase().includes('google') || $json.chatInput.toLowerCase().includes('drive') || $json.chatInput.toLowerCase().includes('é›²ç«¯') }}",
              "type": "boolean"
            }
          ]
        },
        "options": {}
      },
      "id": "parse-input-201",
      "name": "ğŸ” è§£æä½¿ç”¨è€…è¼¸å…¥",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [480, 400],
      "notes": "ğŸ¤– æ™ºèƒ½è­˜åˆ¥åŠŸèƒ½:\n\né—œéµå­— â†’ ä¾†æº\nâ”â”â”â”â”â”â”â”â”â”â”â”\næœ¬æ©Ÿ/æœ¬åœ°/ä¸Šå‚³ â†’ local_upload\nGoogle/Drive/é›²ç«¯ â†’ google_drive\nç„¡é—œéµå­— â†’ all (å…¨éƒ¨)"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": ""
          },
          "conditions": [
            {
              "id": "condition-01",
              "leftValue": "={{ $json.source_filter }}",
              "rightValue": "all",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "if-filter-201",
      "name": "â“ æ˜¯å¦éœ€è¦éæ¿¾ä¾†æº",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.1,
      "position": [720, 400]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "filter-01",
              "name": "filter_config",
              "value": "={{ { \"where\": { \"source\": { \"$eq\": $json.source_filter } } } }}",
              "type": "object"
            },
            {
              "id": "filter-02",
              "name": "source_name",
              "value": "={{ $json.source_filter === 'local_upload' ? 'æœ¬æ©Ÿä¸Šå‚³æª”æ¡ˆ ğŸ“¤' : 'Google Drive æª”æ¡ˆ â˜ï¸' }}",
              "type": "string"
            },
            {
              "id": "filter-03",
              "name": "source_icon",
              "value": "={{ $json.source_filter === 'local_upload' ? 'ğŸ“¤' : 'â˜ï¸' }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "set-filter-201",
      "name": "ğŸ¯ è¨­å®šä¾†æºéæ¿¾",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [960, 200],
      "notes": "âœ… æœ‰æŒ‡å®šä¾†æº\n\néæ¿¾æ¢ä»¶:\nwhere: {\n  source: {\n    $eq: \"local_upload\"\n    æˆ– \"google_drive\"\n  }\n}"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "no-filter-01",
              "name": "filter_config",
              "value": "={}",
              "type": "object"
            },
            {
              "id": "no-filter-02",
              "name": "source_name",
              "value": "æ‰€æœ‰æ–‡ä»¶ ğŸ“š",
              "type": "string"
            },
            {
              "id": "no-filter-03",
              "name": "source_icon",
              "value": "ğŸ“š",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "no-filter-201",
      "name": "ğŸŒ æŸ¥è©¢æ‰€æœ‰ä¾†æº",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [960, 600],
      "notes": "âŒ æœªæŒ‡å®šä¾†æº\n\næŸ¥è©¢ç¯„åœ:\næ‰€æœ‰å¯ç”¨æ–‡ä»¶\n(æœ¬æ©Ÿä¸Šå‚³ + Google Drive)"
    },
    {
      "parameters": {
        "mode": "mergeByPosition",
        "options": {}
      },
      "id": "merge-201",
      "name": "ğŸ”— åˆä½µåˆ†æ”¯",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [1200, 400]
    },
    {
      "parameters": {
        "agent": "toolsAgent",
        "promptType": "define",
        "text": "=ä½ æ˜¯ä¸€å€‹å°ˆæ¥­çš„æ–‡ä»¶åŠ©ç† AI,åç¨±æ˜¯ã€ŒDocuBot Proã€ã€‚\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nã€ç•¶å‰æŸ¥è©¢è¨­å®šã€‘\nğŸ¯ æŸ¥è©¢ç¯„åœ: {{ $json.source_name }}\nâ“ ä½¿ç”¨è€…å•é¡Œ: {{ $('ğŸ” è§£æä½¿ç”¨è€…è¼¸å…¥').item.json.clean_question }}\nâ° æŸ¥è©¢æ™‚é–“: {{ $now.toFormat('yyyy-MM-dd HH:mm:ss') }}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nã€æ ¸å¿ƒä»»å‹™ã€‘\nä½¿ç”¨ document_search å·¥å…·åœ¨æŒ‡å®šç¯„åœå…§æœå°‹ç­”æ¡ˆ,æä¾›æº–ç¢ºã€å°ˆæ¥­çš„å›ç­”ã€‚\n\nã€å›ç­”æº–å‰‡ã€‘\n\n1ï¸âƒ£ **è³‡è¨Šä¾†æºé€æ˜åº¦**\n   - æ˜ç¢ºèªªæ˜è³‡è¨Šä¾†è‡ªå“ªå€‹ä¾†æº\n   - å¦‚æœæœ‰å¤šå€‹ä¾†æº,åˆ†åˆ¥èªªæ˜\n   - æä¾›æ–‡ä»¶åç¨±æˆ–æ¨™é¡Œ (å¦‚æœå¯ç”¨)\n\n2ï¸âƒ£ **æº–ç¢ºæ€§ç¬¬ä¸€**\n   - åš´æ ¼æ ¹æ“šæª¢ç´¢åˆ°çš„æ–‡ä»¶å…§å®¹å›ç­”\n   - ä¸ç¢ºå®šçš„è³‡è¨Šè¦æ˜ç¢ºæ¨™è¨»\n   - æ‰¾ä¸åˆ°ç­”æ¡ˆæ™‚,èª å¯¦å‘ŠçŸ¥ä¸¦å»ºè­°æ›¿ä»£æ–¹æ¡ˆ\n\n3ï¸âƒ£ **å›ç­”çµæ§‹**\n   âœ… ä½¿ç”¨ç¹é«”ä¸­æ–‡\n   âœ… æ¢ç†æ¸…æ™°,é©ç•¶åˆ†é»èªªæ˜\n   âœ… è¤‡é›œå…§å®¹ä½¿ç”¨åˆ—è¡¨æˆ–è¡¨æ ¼\n   âœ… é‡è¦è³‡è¨Šå¯ç”¨ **ç²—é«”** å¼·èª¿\n\n4ï¸âƒ£ **å°ˆæ¥­äº’å‹•**\n   - ä¿æŒå‹å–„ã€è€å¿ƒçš„èªæ°£\n   - ç†è§£ä¸Šä¸‹æ–‡å’Œå°è©±æ­·å²\n   - å•é¡Œä¸æ¸…æ¥šæ™‚,ç¦®è²Œè©¢å•\n   - é¿å…éåº¦æŠ€è¡“æ€§ç”¨èª\n\n5ï¸âƒ£ **ç‰¹åˆ¥æé†’**\n   {{ $json.source_filter !== 'all' ? 'âš ï¸ æ³¨æ„:ç›®å‰åªåœ¨ã€Œ' + $json.source_name + 'ã€ä¸­æœå°‹,å¦‚éœ€æœå°‹å…¶ä»–ä¾†æº,è«‹æ˜ç¢ºå‘ŠçŸ¥ã€‚' : 'ğŸ’¡ æç¤º:ç›®å‰æœå°‹æ‰€æœ‰å¯ç”¨æ–‡ä»¶ã€‚å¦‚éœ€é™åˆ¶æœå°‹ç¯„åœ,å¯ä»¥æŒ‡å®šã€Œå¾æœ¬æ©Ÿæª”æ¡ˆã€æˆ–ã€Œå¾ Google Driveã€ã€‚' }}\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nã€é–‹å§‹å›ç­”ã€‘",
        "options": {
          "systemMessage": "=ğŸ“Š ç³»çµ±è³‡è¨Š\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ—„ï¸ å‘é‡è³‡æ–™åº«: å·²é€£æ¥\nğŸ” æª¢ç´¢ç¯„åœ: {{ $json.source_name }}\nğŸŒ å›æ‡‰èªè¨€: ç¹é«”ä¸­æ–‡\nğŸ¤– æ¨¡å‹: Google Gemini 1.5 Flash\nâš™ï¸ Temperature: 0.3 (ç²¾ç¢ºæ¨¡å¼)\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        }
      },
      "id": "ai-agent-201",
      "name": "ğŸ¤– AI Agent (é€²éš)",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.8,
      "position": [1440, 400]
    },
    {
      "parameters": {
        "model": "gemini-1.5-flash",
        "options": {
          "temperature": 0.3,
          "maxOutputTokens": 2048,
          "topP": 0.9,
          "topK": 40
        }
      },
      "id": "gemini-chat-201",
      "name": "ğŸ§  Google Gemini Flash",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1.1,
      "position": [1440, 600]
    },
    {
      "parameters": {
        "name": "document_search",
        "description": "=ã€æ–‡ä»¶æª¢ç´¢å·¥å…·ã€‘\n\nğŸ¯ ç•¶å‰æœå°‹ç¯„åœ: {{ $('ğŸ”— åˆä½µåˆ†æ”¯').item.json.source_name }}\n\nã€åŠŸèƒ½èªªæ˜ã€‘\nåœ¨æŒ‡å®šçš„æ–‡ä»¶ä¾†æºä¸­æœå°‹ç›¸é—œè³‡è¨Šã€‚\n\nã€ä½¿ç”¨æ™‚æ©Ÿã€‘\nâ€¢ éœ€è¦æŸ¥æ‰¾å…·é«”è³‡è¨Š\nâ€¢ é©—è­‰æŸå€‹èªªæ³•\nâ€¢ äº†è§£è©³ç´°å…§å®¹\n\nã€è¼¸å…¥æ ¼å¼ã€‘\nè¼¸å…¥å•é¡Œçš„é—œéµå­—æˆ–å®Œæ•´å•é¡Œå¥å­ã€‚\n\nã€è¼¸å‡ºå…§å®¹ã€‘\nTop 5 æœ€ç›¸é—œçš„æ–‡ä»¶æ®µè½\n\n{{ $('ğŸ”— åˆä½µåˆ†æ”¯').item.json.source_filter !== 'all' ? 'âš ï¸ åƒ…æœå°‹: ' + $('ğŸ”— åˆä½µåˆ†æ”¯').item.json.source_name : 'ğŸ’¡ æœå°‹: æ‰€æœ‰å¯ç”¨æ–‡ä»¶' }}",
        "topK": 5,
        "options": {
          "metadata": "={{ $('ğŸ”— åˆä½µåˆ†æ”¯').item.json.filter_config }}"
        }
      },
      "id": "vector-tool-201",
      "name": "ğŸ” Vector Store Tool (å‹•æ…‹éæ¿¾)",
      "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
      "typeVersion": 1.1,
      "position": [1680, 400],
      "notes": "ğŸ¯ å‹•æ…‹ä¾†æºéæ¿¾\n\næ ¹æ“šä½¿ç”¨è€…æ„åœ–,è‡ªå‹•è¨­å®š:\nâ€¢ local_upload éæ¿¾\nâ€¢ google_drive éæ¿¾\nâ€¢ æˆ–ä¸éæ¿¾ (å…¨éƒ¨)"
    },
    {
      "parameters": {
        "mode": "retrieve",
        "options": {}
      },
      "id": "vector-store-201",
      "name": "ğŸ’¾ Simple Vector Store",
      "type": "@n8n/n8n-nodes-langchain.vectorStoreInMemory",
      "typeVersion": 1,
      "position": [1680, 600]
    },
    {
      "parameters": {
        "model": "text-embedding-004"
      },
      "id": "embeddings-201",
      "name": "ğŸ§  Embeddings Google Gemini",
      "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
      "typeVersion": 1,
      "position": [1680, 800]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "respond-201",
      "name": "ğŸ’¬ Respond to Chat",
      "type": "@n8n/n8n-nodes-langchain.respondToChat",
      "typeVersion": 1.1,
      "position": [1920, 400]
    }
  ],
  "connections": {
    "ğŸ’¬ Chat Trigger": {
      "main": [
        [
          {
            "node": "ğŸ” è§£æä½¿ç”¨è€…è¼¸å…¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ” è§£æä½¿ç”¨è€…è¼¸å…¥": {
      "main": [
        [
          {
            "node": "â“ æ˜¯å¦éœ€è¦éæ¿¾ä¾†æº",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "â“ æ˜¯å¦éœ€è¦éæ¿¾ä¾†æº": {
      "main": [
        [
          {
            "node": "ğŸ¯ è¨­å®šä¾†æºéæ¿¾",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸŒ æŸ¥è©¢æ‰€æœ‰ä¾†æº",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¯ è¨­å®šä¾†æºéæ¿¾": {
      "main": [
        [
          {
            "node": "ğŸ”— åˆä½µåˆ†æ”¯",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸŒ æŸ¥è©¢æ‰€æœ‰ä¾†æº": {
      "main": [
        [
          {
            "node": "ğŸ”— åˆä½µåˆ†æ”¯",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "ğŸ”— åˆä½µåˆ†æ”¯": {
      "main": [
        [
          {
            "node": "ğŸ¤– AI Agent (é€²éš)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¤– AI Agent (é€²éš)": {
      "main": [
        [
          {
            "node": "ğŸ’¬ Respond to Chat",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ§  Google Gemini Flash": {
      "ai_languageModel": [
        [
          {
            "node": "ğŸ¤– AI Agent (é€²éš)",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ” Vector Store Tool (å‹•æ…‹éæ¿¾)": {
      "ai_tool": [
        [
          {
            "node": "ğŸ¤– AI Agent (é€²éš)",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’¾ Simple Vector Store": {
      "ai_vectorStore": [
        [
          {
            "node": "ğŸ” Vector Store Tool (å‹•æ…‹éæ¿¾)",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ§  Embeddings Google Gemini": {
      "ai_embedding": [
        [
          {
            "node": "ğŸ’¾ Simple Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2025-01-17T00:00:00.000Z",
      "updatedAt": "2025-01-17T00:00:00.000Z",
      "id": "tag-007",
      "name": "RAGç³»çµ±"
    },
    {
      "createdAt": "2025-01-17T00:00:00.000Z",
      "updatedAt": "2025-01-17T00:00:00.000Z",
      "id": "tag-008",
      "name": "é€²éšåŠŸèƒ½"
    }
  ],
  "triggerCount": 0,
  "updatedAt": "2025-01-17T00:00:00.000Z",
  "versionId": "workflow-04-v1"
}
