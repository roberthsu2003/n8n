# 智能客服聊天機器人 - 使用指南

## 🎯 快速開始

### 1. 導入 Workflow
- 在 n8n 中導入 `智能客服聊天機器人.json`
- 或從本教學文檔按照步驟手動建立

### 2. 設定 API 憑證
```
OpenAI Chat Model 節點
├─ Credentials: OpenAI API Key
├─ Model: gpt-3.5-turbo (建議)
└─ Temperature: 0.7 (可調整創意度)
```

### 3. 啟動並測試
- 啟動 Workflow
- 開啟聊天介面
- 發送測試訊息

## 🔧 節點說明

### 📱 客服聊天 (Chat Trigger)
**類型**: `@n8n/n8n-nodes-langchain.chatTrigger` v1.1

**功能**: 接收用戶訊息的觸發器

**設定**:
- ✅ Public: 啟用公開訪問
- ✅ Initial Messages: 歡迎訊息
- ✅ Title: 智能客服聊天機器人
- ✅ Response Mode: lastNode

**測試方式**:
1. 點擊節點查看 Webhook URL
2. 在瀏覽器中打開 URL
3. 開始對話測試

---

### 🤖 AI 客服代理 (AI Agent)
**類型**: `@n8n/n8n-nodes-langchain.agent` v2.2

**功能**: AI 處理核心，負責理解與回應

**System Message 重點**:
- 定義角色：友善且專業的客服助理
- 設定個性：友善、耐心、樂於助人
- 明確職責：回應問題、提供資訊、解決問題
- 對話原則：簡潔、清晰、記憶上下文

**可調整項目**:
- **語氣**: 修改 System Message 中的 personality 部分
- **回應長度**: 調整「不超過 150 字」的限制
- **專業領域**: 在 instructions 中加入特定產品知識

---

### 💬 OpenAI Chat Model
**類型**: `@n8n/n8n-nodes-langchain.lmChatOpenAi` v1

**功能**: 提供 AI 語言理解與生成能力

**建議設定**:
```json
{
  "model": "gpt-3.5-turbo",
  "temperature": 0.7,
  "maxTokens": 500
}
```

**參數說明**:
- **Model**: 
  - `gpt-3.5-turbo`: 快速、經濟（推薦入門）
  - `gpt-4`: 更智能、較貴（推薦進階）
  
- **Temperature** (0-2):
  - `0.3-0.5`: 更保守、一致
  - `0.7`: 平衡（推薦）
  - `1.0-1.5`: 更有創意

- **Max Tokens**:
  - `300-500`: 一般對話（推薦）
  - `800-1000`: 需要詳細說明時

**成本估算**:
- GPT-3.5-turbo: 約 $0.002 / 1K tokens
- GPT-4: 約 $0.03 / 1K tokens

**切換為 Google Gemini**:
1. 刪除此節點
2. 加入「Google Gemini Chat Model」節點
3. 設定:
   ```json
   {
     "model": "gemini-pro",
     "temperature": 0.7
   }
   ```
4. 連接到 AI 客服代理

---

### 🧠 對話記憶 (Conversation Memory)
**類型**: `@n8n/n8n-nodes-langchain.memoryBufferWindow` v1.3

**功能**: 儲存對話歷史，提供上下文理解

**設定**:
```json
{
  "contextWindowLength": 20
}
```

**說明**:
- **20 則訊息**: 記住最近 10 輪對話（每輪包含用戶問題+AI 回答）
- **記憶範圍**: 僅限當前會話，重新整理後會清空

**調整建議**:
- **短期對話** (FAQ): 10-15 則
- **一般客服**: 20-30 則（推薦）
- **深度諮詢**: 40-50 則

**記憶限制**:
- 過多記憶會增加 API 成本
- 過少記憶可能失去對話脈絡
- 建議根據實際需求調整

---

## 🎨 自訂 System Prompt

### 專業型客服
```
你是一個專業且嚴謹的客服專員。
- 使用正式、專業的語氣
- 提供精確、詳細的技術資訊
- 回應結構清晰，條列重點
```

### 親切型客服
```
你是一個友善親切的客服夥伴。
- 使用輕鬆、溫暖的語氣
- 適時使用表情符號 😊
- 像朋友一樣與客戶互動
```

### 技術支援型
```
你是一個技術支援專家。
- 專注於解決技術問題
- 提供詳細的步驟說明
- 使用清晰的技術術語
```

## 📊 測試腳本

### 基本對話測試
```
1. "你好" → 檢查歡迎回應
2. "你們有什麼產品？" → 檢查產品資訊
3. "我想退貨" → 檢查問題處理
4. "謝謝" → 檢查結束對話
```

### 記憶功能測試
```
1. "我叫小明" → AI 應記住名字
2. "我的訂單號碼是 12345" → AI 應記住訂單號
3. "我剛才說的訂單號碼是什麼？" → 檢查記憶
4. "我叫什麼名字？" → 再次檢查記憶
```

### 多輪對話測試
```
1. "我想買一台筆電"
2. "預算大約 3 萬元"
3. "有推薦的型號嗎？"
4. "這個型號有什麼特色？"
（檢查 AI 是否能追蹤整個對話脈絡）
```

## 🚀 進階功能擴展

### 1. 加入知識庫 (RAG)
```
新增節點：
├─ Vector Store (Pinecone/Supabase)
├─ Embeddings (OpenAI Embeddings)
└─ Document Loader (載入產品文件)

效果：AI 可以查詢內部文件回答問題
```

### 2. 加入工具功能
```
新增節點：
├─ HTTP Request Tool (查詢訂單 API)
├─ SQL Tool (查詢資料庫)
└─ Calculator Tool (計算價格)

效果：AI 可以執行實際操作
```

### 3. 多語言支援
```
修改 System Message：
"你可以使用繁體中文、英文、日文進行對話。
根據用戶的語言自動切換回應語言。"

效果：自動偵測並切換語言
```

### 4. 情緒偵測與處理
```
新增節點：
└─ Sentiment Analysis Tool

修改 System Message：
"若客戶情緒不佳，請展現同理心，
並主動提出協助解決方案。"

效果：更好地處理客訴
```

## 📈 效能優化

### 降低回應時間
1. 使用 `gpt-3.5-turbo` 而非 `gpt-4`
2. 減少 `maxTokens` 參數
3. 簡化 System Message
4. 減少記憶長度

### 降低成本
1. 選擇較便宜的模型
2. 限制 `maxTokens`
3. 減少不必要的記憶
4. 考慮切換為 Google Gemini

### 提升回應品質
1. 優化 System Prompt
2. 提供更多範例
3. 增加知識庫
4. 調整 Temperature 參數

## 🐛 常見問題排除

### Q: AI 回應很慢
**可能原因**:
- API 網路延遲
- 模型選擇 (GPT-4 較慢)
- System Message 過長

**解決方案**:
- 切換為 `gpt-3.5-turbo`
- 簡化 System Prompt
- 檢查網路連線

---

### Q: AI 無法記住對話
**可能原因**:
- 記憶節點未連接
- 記憶長度設定過短
- 會話已過期

**解決方案**:
- 確認「對話記憶」節點已連接到 AI Agent
- 增加 `contextWindowLength`
- 檢查瀏覽器 Session

---

### Q: API 錯誤 401
**可能原因**:
- API Key 無效或過期
- 未設定 API Key

**解決方案**:
- 重新取得 OpenAI API Key
- 在節點中更新憑證
- 確認 API Key 有足夠額度

---

### Q: 回應內容不符合預期
**可能原因**:
- System Prompt 不夠明確
- Temperature 設定過高
- 缺少範例

**解決方案**:
- 優化 System Message，提供更明確的指示
- 降低 Temperature (0.3-0.5)
- 在 System Message 中加入對話範例

---

## 📚 延伸學習

### 推薦資源
1. [n8n AI Agent 官方文件](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.agent/)
2. [OpenAI Prompt Engineering](https://platform.openai.com/docs/guides/prompt-engineering)
3. [LangChain Memory](https://js.langchain.com/docs/modules/memory/)

### 下一步學習
1. 完成「範例二：知識庫查詢系統」
2. 學習 RAG (Retrieval-Augmented Generation)
3. 探索多工具整合
4. 研究 Agent 決策邏輯

---

## 💡 實用小技巧

### Tip 1: 快速測試不同 Prompt
複製整個 Workflow，建立多個版本測試不同的 System Message，找出最適合的設定。

### Tip 2: 監控成本
在 OpenAI Dashboard 中設定使用量警告，避免超支。

### Tip 3: 版本控制
將 Workflow JSON 存入 Git，記錄每次修改，方便回溯。

### Tip 4: A/B 測試
部署兩個版本，比較不同設定的效果，持續優化。

---

**祝您使用愉快！有任何問題歡迎參考 README.md 或相關文件。** 🎉
