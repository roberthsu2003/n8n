# 範例三：具備工具使用能力的助理

## 📚 學習目標

讓 AI 能夠執行實際操作，學習如何建立一個具備工具使用能力的 AI 助理。

## 🎯 難度等級

**難度**: ⭐⭐☆ (中級)  
**學習時間**: 45-60 分鐘  
**階段**: 階段二：中階應用

## 📋 工作流程說明

這個範例展示如何建立一個能夠使用工具的 AI 助理，能夠：
- 理解用戶需求並決定使用哪個工具
- 執行計算、API 呼叫等實際操作
- 整合多個工具完成複雜任務
- 提供工具執行的結果

## 🔧 使用節點

- **Chat Trigger** - 對話入口
- **AI Agent (Tools Agent)** - 具備工具使用能力的 AI Agent
- **OpenAI Chat Model** - 語言模型
- **Calculator Tool** - 計算工具
- **Call n8n Workflow Tool** - 呼叫其他 workflow
- **HTTP Request Tool** - 自訂工具（API 呼叫）

## 📌 Sticky 規劃

```
📌 Sticky 1: "對話入口"
📌 Sticky 2: "AI Agent - 決策中心"
📌 Sticky 3: "工具箱 - 計算器、API 呼叫"
📌 Sticky 4: "外部服務整合"
```

### Sticky 使用原則：
- 🟦 **藍色 Sticky**：輸入/觸發器
- 🟩 **綠色 Sticky**：AI 處理核心
- 🟨 **黃色 Sticky**：工具與外部服務
- 🟧 **橘色 Sticky**：輸出/回應
- 🟥 **紅色 Sticky**：錯誤處理

## 🎓 教學重點

### 1. Tools Agent 的運作方式

**Tools Agent** 是能夠使用工具的 AI Agent：
- AI 會分析用戶需求
- 決定需要使用哪些工具
- 自動呼叫工具並取得結果
- 基於工具結果生成最終回答

**工作流程**：
1. 用戶提出需求 → "幫我計算 123 + 456"
2. AI 分析需求 → 識別需要計算
3. AI 選擇工具 → 使用 Calculator Tool
4. 執行工具 → 計算結果：579
5. AI 生成回答 → "計算結果是 579"

### 2. 如何讓 AI 決定使用哪個工具

**工具描述**是關鍵：
- 每個工具都需要清楚的描述
- AI 會根據描述判斷是否使用該工具
- 描述應該包含：
  - 工具的功能
  - 使用時機
  - 輸入參數說明
  - 輸出格式

**範例 - Calculator Tool 描述**：
```
這是一個計算器工具，可以執行數學運算。
當用戶需要計算數字、公式或數學問題時使用。
輸入：數學表達式（例如：123 + 456）
輸出：計算結果
```

### 3. 自訂工具的建立

**HTTP Request Tool** 可以建立自訂工具：
- 將任何 HTTP API 封裝成工具
- AI 可以自動呼叫這些 API
- 適合整合外部服務

**建立步驟**：
1. 加入 **HTTP Request Tool** 節點
2. 設定 API 端點和參數
3. 定義工具名稱和描述
4. 在 AI Agent 中註冊工具

## ⚙️ 設定步驟

### 步驟一：建立 Tools Agent
1. 加入 **Chat Trigger** 節點
2. 加入 **AI Agent** 節點
3. 選擇 Agent 類型：**Tools Agent**
4. 連接 Chat Trigger 到 AI Agent

### 步驟二：設定語言模型
1. 在 AI Agent 中選擇 **Chat Model**
2. 選擇 **OpenAI Chat Model**
3. 設定 API 憑證
4. 選擇模型（建議：`gpt-4` 或 `gpt-3.5-turbo`）

### 步驟三：加入 Calculator Tool
1. 加入 **Calculator Tool** 節點
2. 設定工具名稱：`計算器`
3. 設定工具描述：
   ```
   這是一個數學計算器，可以執行加減乘除等運算。
   當用戶需要計算數字或數學表達式時使用。
   ```
4. 在 AI Agent 中註冊此工具

### 步驟四：加入 Call n8n Workflow Tool
1. 加入 **Call n8n Workflow Tool** 節點
2. 設定要呼叫的 Workflow ID
3. 設定工具名稱和描述
4. 在 AI Agent 中註冊此工具

### 步驟五：建立自訂 HTTP Request Tool（選用）
1. 加入 **HTTP Request Tool** 節點
2. 設定 API 端點（例如：天氣 API）
3. 設定請求參數
4. 定義工具描述：
   ```
   這是一個天氣查詢工具。
   當用戶詢問天氣時使用。
   輸入：城市名稱
   輸出：天氣資訊
   ```
5. 在 AI Agent 中註冊此工具

### 步驟六：設定 System Prompt
```
你是一個智能助理，可以使用各種工具來幫助用戶。
當用戶需要計算、查詢資訊或執行操作時，請選擇合適的工具。
使用工具後，請根據結果提供清晰的回答。
```

### 步驟七：測試工具使用
1. 啟用工作流程
2. 測試計算功能：「幫我計算 100 * 25」
3. 測試 API 呼叫：「查詢台北的天氣」
4. 觀察 AI 如何選擇和使用工具

## 💡 實際應用場景

- **數據分析助理**：執行計算、查詢資料庫、生成報表
- **API 整合助理**：呼叫各種 API，整合多個服務
- **工作流程自動化**：觸發其他 n8n workflow，執行複雜任務
- **資訊查詢助理**：查詢天氣、股價、新聞等即時資訊
- **業務處理助理**：處理訂單、發送通知、更新資料庫

## 🔧 進階功能擴展

### 練習 1：建立多個自訂工具
建立工具庫，包含：
- 天氣查詢工具
- 股價查詢工具
- 翻譯工具
- 單位轉換工具

### 練習 2：工具鏈式使用
讓 AI 能夠串聯多個工具：
- 查詢天氣 → 根據天氣建議活動 → 搜尋相關資訊
- 計算數據 → 查詢資料庫 → 生成報告

### 練習 3：工具錯誤處理
加入錯誤處理機制：
- 當工具執行失敗時，AI 能夠識別錯誤
- 提供替代方案或錯誤訊息
- 記錄工具使用日誌

### 練習 4：工具權限控制
實作工具使用權限：
- 某些工具需要特定權限才能使用
- AI 能夠判斷用戶權限
- 無權限時提供替代方案

## 📌 常見問題

### Q: AI 不使用工具怎麼辦？
**A**: 
- 檢查工具描述是否清楚
- 確認工具已在 AI Agent 中註冊
- 優化 System Prompt，明確指示 AI 使用工具
- 使用更強大的模型（GPT-4 比 GPT-3.5 更善於使用工具）

### Q: 如何讓 AI 知道何時使用工具？
**A**: 
- 在 System Prompt 中明確說明工具的使用時機
- 提供範例對話，展示工具使用場景
- 工具描述要清楚且具體

### Q: 可以建立多少個工具？
**A**: 
- 理論上沒有限制，但建議不超過 10-15 個
- 太多工具會讓 AI 難以選擇
- 可以將相關工具分組，建立多個 Tools Agent

## 📚 相關資源

- [n8n Tools Agent 文件](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.agent/)
- [OpenAI Function Calling](https://platform.openai.com/docs/guides/function-calling)
- [n8n HTTP Request Tool](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.httptool/)

---

**🎓 完成此範例後，您將理解如何讓 AI 使用工具，建立更強大的自動化助理！**

