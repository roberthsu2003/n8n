# 📚 RAG 智能文件問答系統 - 完整使用指南

## 🎯 專案總覽

這是一套完整的 **RAG (Retrieval-Augmented Generation)** 智能文件問答系統,包含 4 個 n8n Workflow,可以讓您:

✅ 上傳本機檔案建立 AI 索引  
✅ 自動同步 Google Drive 檔案  
✅ 透過 AI 對話介面查詢文件內容  
✅ 支援來源過濾的進階查詢

---

## 📦 檔案清單

### **Workflow 1A: 本機檔案上傳索引**
📁 檔案名稱: `01_RAG文件索引_本機上傳.json`

**功能說明:**
- 提供網頁表單供使用者上傳文件
- 支援 PDF、Word、TXT 格式
- 自動提取內容並建立向量索引
- 記錄文件標題、分類、上傳時間等資訊

**適用場景:**
- 快速上傳個人文件
- 臨時文件索引
- 測試 RAG 功能

---

### **Workflow 1B: Google Drive 自動同步**
📁 檔案名稱: `02_RAG文件索引_Google_Drive同步.json`

**功能說明:**
- 每天自動從 Google Drive 同步文件
- 支援 PDF、Word、TXT 格式
- 自動處理新增或更新的檔案
- 保留完整的檔案元資料

**適用場景:**
- 團隊共用文件庫
- 企業知識庫管理
- 自動化文件更新

---

### **Workflow 2A: RAG 智能問答 (基礎版)**
📁 檔案名稱: `03_RAG智能問答_基礎版.json`

**功能說明:**
- 簡單易用的對話介面
- 自動檢索相關文件
- 提供準確的 AI 回答
- 支援多輪對話

**適用場景:**
- 快速部署使用
- 教學演示
- 個人使用

---

### **Workflow 2B: RAG 智能問答 (進階版)**
📁 檔案名稱: `04_RAG智能問答_進階版_來源過濾.json`

**功能說明:**
- 智能識別查詢來源意圖
- 支援來源過濾 (本機 / Google Drive / 全部)
- 更詳細的系統提示
- 更精確的答案生成

**適用場景:**
- 多來源文件管理
- 企業級應用
- 需要來源追蹤的情境

---

## 🚀 快速開始

### **步驟 1: 匯入 Workflow**

1. 登入您的 n8n 系統
2. 點選 **Workflows** → **Import from File**
3. 依序匯入 4 個 JSON 檔案
4. 確認所有 Workflow 都成功匯入

---

### **步驟 2: 設定 Google Gemini 憑證**

所有 Workflow 都使用 **Google Gemini** (免費!)

1. 前往 [Google AI Studio](https://aistudio.google.com/app/apikey)
2. 建立 API Key
3. 在 n8n 中新增 Google Gemini 憑證:
   - 憑證類型: `Google Gemini`
   - API Key: 貼上您的 Key

---

### **步驟 3: 設定 Google Drive (選用)**

如果要使用 Workflow 1B:

1. 在 n8n 中設定 Google Drive OAuth2 憑證
2. 修改 `📂 列出 Google Drive 檔案` 節點:
   - 選擇要同步的資料夾
   - 設定檔案類型過濾
3. 測試連線

---

### **步驟 4: 建立文件索引**

**方法 A: 本機上傳**
1. 開啟 Workflow 1A
2. 點選 `📤 表單觸發器` 節點
3. 複製 **Production URL**
4. 在瀏覽器開啟該網址
5. 上傳您的文件

**方法 B: Google Drive 同步**
1. 開啟 Workflow 1B
2. 點選 **Test workflow** 測試執行
3. 確認檔案成功索引
4. 啟用排程 (每天自動執行)

---

### **步驟 5: 開始問答**

**基礎版:**
1. 開啟 Workflow 2A
2. 點選 `💬 Chat Trigger` 節點
3. 複製 **Production URL**
4. 在瀏覽器開啟對話介面
5. 開始提問!

**進階版:**
1. 開啟 Workflow 2B
2. 取得對話介面網址
3. 測試不同的查詢方式:
   - "什麼是 RAG?" (搜尋全部)
   - "從本機檔案查詢..." (只搜尋上傳的檔案)
   - "從 Google Drive 查詢..." (只搜尋雲端檔案)

---

## 🎓 教學建議

### **第一週:基礎建置 (2 堂課)**

**第 1 堂課 - 認識 RAG 與文件索引**
- 講解 RAG 原理 (15分鐘)
- 實作 Workflow 1A (30分鐘)
- 測試檔案上傳 (15分鐘)

**第 2 堂課 - 智能問答系統**
- 實作 Workflow 2A (20分鐘)
- 測試問答功能 (20分鐘)
- 參數調整與優化 (20分鐘)

---

### **第二週:進階功能 (2 堂課)**

**第 3 堂課 - Google Drive 整合**
- 設定 Google Drive 憑證 (15分鐘)
- 實作 Workflow 1B (30分鐘)
- 測試自動同步 (15分鐘)

**第 4 堂課 - 來源過濾與進階功能**
- 實作 Workflow 2B (25分鐘)
- 測試來源過濾 (20分鐘)
- 綜合應用討論 (15分鐘)

---

## 🧪 測試建議

### **基礎測試**

```
✅ 測試 1: 簡單事實查詢
問題: "什麼是 n8n?"
預期: 從文件中找到 n8n 的定義

✅ 測試 2: 步驟性問題
問題: "如何設定 webhook?"
預期: 提供清楚的步驟說明

✅ 測試 3: 找不到答案
問題: "明天天氣如何?"
預期: 明確告知文件中沒有相關資訊

✅ 測試 4: 多輪對話
問題 1: "什麼是 API?"
問題 2: "它有什麼用途?"
預期: 理解 "它" 指的是 API
```

---

### **進階測試 (Workflow 2B)**

```
✅ 測試 5: 指定本機來源
問題: "從本機檔案中查詢產品規格"
檢查: 執行日誌中 source_filter = "local_upload"

✅ 測試 6: 指定雲端來源
問題: "從 Google Drive 查詢公司政策"
檢查: source_filter = "google_drive"

✅ 測試 7: 自動識別
問題: "RAG 的優點是什麼?"
檢查: source_filter = "all"
```

---

## ⚙️ 參數調整指南

### **提升答案準確度**

1. **增加檢索數量**
   - 節點: `🔍 Vector Store Tool`
   - 參數: `topK`
   - 建議: 從 4 調整到 6 或 8

2. **降低 Temperature**
   - 節點: `🧠 Google Gemini Chat Model`
   - 參數: `temperature`
   - 建議: 從 0.3 降低到 0.2

---

### **處理較長文件**

1. **調整 Chunk Size**
   - 節點: `✂️ 遞迴字元分割器`
   - 參數: `chunkSize`
   - 建議: 從 800 調整到 1000 或 1200

2. **調整 Overlap**
   - 參數: `chunkOverlap`
   - 建議: 維持 Chunk Size 的 20-25%

---

## 🔧 常見問題排除

### **問題 1: Vector Store 找不到資料**

**可能原因:**
- Workflow 1 尚未執行
- Embedding 模型不一致

**解決方法:**
1. 確認 Workflow 1A 或 1B 已成功執行
2. 檢查兩個 Workflow 的 Embedding 節點:
   - 必須都使用 `text-embedding-004`
3. 重新執行索引流程

---

### **問題 2: Google Drive 同步失敗**

**可能原因:**
- OAuth2 憑證過期
- 資料夾權限不足

**解決方法:**
1. 重新授權 Google Drive 憑證
2. 確認 n8n 有存取該資料夾的權限
3. 檢查資料夾 ID 是否正確

---

### **問題 3: AI 回答不準確**

**可能原因:**
- Top K 值太小
- Temperature 太高
- 文件品質問題

**解決方法:**
1. 增加 Top K 到 6-8
2. 降低 Temperature 到 0.2
3. 檢查上傳的文件內容是否完整
4. 優化 System Message 指令

---

## 🎨 Sticky Notes 顏色系統

所有 Workflow 都遵循統一的顏色規則:

🔵 **藍色** - 輸入/觸發節點  
🟢 **綠色** - AI 處理/轉換節點  
🟡 **黃色** - 工具/外部服務  
🟠 **橘色** - 輸出/儲存節點  
🔴 **紅色** - 錯誤處理/重要提醒

*(註: Sticky Notes 需要在匯入後手動添加)*

---

## 🚀 進階擴展建議

### **功能擴展 1: 加入對話記憶**

在 Workflow 2A/2B 中添加:
- 節點: `Simple Memory`
- 參數: `contextWindowLength = 5`
- 效果: 記住最近 5 輪對話

---

### **功能擴展 2: 多模型支援**

使用 Switch 節點切換不同 AI 模型:
- Gemini 1.5 Flash (快速)
- Gemini 1.5 Pro (準確)
- 其他支援的模型

---

### **功能擴展 3: 引用來源**

修改 System Message,要求 AI 標註資訊來源:

```
當你引用文件時,請標註:
[來源: 本機檔案 - {{title}}]
或
[來源: Google Drive - {{file_name}}]
```

---

## 📊 系統架構圖

```
┌─────────────────────────────────────────────┐
│          RAG 智能文件問答系統                  │
├─────────────────────────────────────────────┤
│                                             │
│  ┌──────────────┐      ┌──────────────┐   │
│  │ Workflow 1A  │      │ Workflow 1B  │   │
│  │  本機上傳    │      │ Drive 同步   │   │
│  └──────┬───────┘      └──────┬───────┘   │
│         │                     │            │
│         └─────────┬───────────┘            │
│                   ▼                        │
│         ┌──────────────────┐               │
│         │ Simple Vector Store│              │
│         │   (向量資料庫)     │              │
│         └─────────┬──────────┘              │
│                   │                         │
│         ┌─────────┴─────────┐               │
│         ▼                   ▼               │
│  ┌──────────────┐    ┌──────────────┐      │
│  │ Workflow 2A  │    │ Workflow 2B  │      │
│  │  基礎問答    │    │  進階問答    │      │
│  └──────────────┘    └──────────────┘      │
│                                             │
└─────────────────────────────────────────────┘
```

---

## 🎓 教學資源

### **官方文檔**
- n8n Docs: https://docs.n8n.io/
- RAG 說明: https://docs.n8n.io/advanced-ai/rag-in-n8n/
- Google Gemini: https://ai.google.dev/

### **相關範本**
- n8n RAG Starter: https://n8n.io/workflows/5010
- AI Agent 範例: n8n Community Workflows

---

## ✅ 檢查清單

### **初次部署**
- [ ] 4 個 Workflow 都已匯入
- [ ] Google Gemini 憑證已設定
- [ ] Workflow 1A 表單可以開啟
- [ ] 測試上傳一個檔案
- [ ] Workflow 2A 對話介面可以開啟
- [ ] 測試一個簡單問題

### **完整功能測試**
- [ ] Google Drive 憑證已設定
- [ ] Workflow 1B 同步測試成功
- [ ] Workflow 2B 來源過濾功能正常
- [ ] 所有測試案例都通過
- [ ] 已優化參數設定

---

## 📞 技術支援

### **問題回報**
如果遇到問題,請提供:
1. Workflow 名稱和版本
2. 錯誤訊息截圖
3. 執行日誌
4. n8n 版本號

### **建議改進**
歡迎提供:
- 新功能建議
- 使用心得分享
- 教學建議

---

## 📝 版本資訊

**版本**: v1.0.0  
**建立日期**: 2025-01-17  
**適用 n8n 版本**: 1.74.0+  
**最後更新**: 2025-01-17

---

## 🎉 結語

這套 RAG 系統是一個**完整的教學專案**,包含:

✅ 多種文件來源整合  
✅ 智能問答功能  
✅ 來源過濾機制  
✅ 詳細的註解說明  
✅ 完整的使用文檔

您可以:
- 直接用於教學
- 作為學生實作專案
- 擴展成企業級應用
- 研究 RAG 技術實作

祝您使用愉快! 🚀

---

**💡 提示**: 建議先從基礎版 (Workflow 1A + 2A) 開始,熟悉後再進入進階功能!
