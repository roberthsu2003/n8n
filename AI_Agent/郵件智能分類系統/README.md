# 範例四：郵件智能分類系統

## 📚 學習目標

學習實際業務應用場景，建立一個能夠自動分類郵件的智能系統。

## 🎯 難度等級

**難度**: ⭐⭐☆ (中級)  
**學習時間**: 45-60 分鐘  
**階段**: 階段二：中階應用

## 📋 工作流程說明

這個範例展示如何建立一個郵件智能分類系統，能夠：
- 自動接收 Gmail 郵件
- 使用 AI 分析郵件內容
- 自動分類郵件（例如：重要、垃圾、待處理）
- 記錄分類結果到 Google Sheets
- 發送分類通知

## 🔧 使用節點

- **Gmail Trigger** - 郵件接收觸發器
- **AI Agent** - AI 處理核心
- **OpenAI Chat Model** - 語言模型
- **Text Classifier** - 文字分類器
- **Gmail** - 發送分類結果
- **Google Sheets** - 記錄分類

## 🎓 教學重點

### 1. 自動化業務流程

**業務流程自動化**的關鍵：
- 識別重複性工作
- 設計自動化流程
- 整合多個服務
- 監控和優化

**郵件分類流程**：
1. 接收郵件 → Gmail Trigger
2. 分析內容 → AI Agent
3. 分類郵件 → Text Classifier
4. 記錄結果 → Google Sheets
5. 發送通知 → Gmail

### 2. Prompt Engineering（提示詞工程）

**有效的分類 Prompt**：
```
分析以下郵件內容，並將其分類為以下類別之一：
1. 重要緊急 - 需要立即處理
2. 重要一般 - 需要處理但不緊急
3. 一般資訊 - 僅供參考
4. 垃圾郵件 - 可以忽略

郵件內容：
[郵件內容]

請以 JSON 格式回應：
{
  "category": "類別名稱",
  "reason": "分類原因",
  "priority": "優先級（1-5）"
}
```

**Prompt 設計原則**：
- 明確的任務說明
- 清楚的輸出格式
- 提供範例（Few-shot learning）
- 包含邊界條件

### 3. 多節點協作

**節點協作流程**：
- **Gmail Trigger** → 觸發流程
- **AI Agent** → 分析郵件
- **Text Classifier** → 分類郵件
- **IF 節點** → 根據分類分流
- **Google Sheets** → 記錄結果
- **Gmail** → 發送通知

## ⚙️ 設定步驟

### 步驟一：設定 Gmail Trigger
1. 加入 **Gmail Trigger** 節點
2. 設定 Gmail 憑證（參考 [Google Cloud API 設定](../Google_Cloud_api服務/README.md)）
3. 選擇觸發條件：
   - **新郵件**：收到新郵件時觸發
   - **特定標籤**：只處理特定標籤的郵件
4. 設定篩選條件（可選）

### 步驟二：設定 AI Agent
1. 加入 **AI Agent** 節點
2. 連接 **Gmail Trigger** 到 **AI Agent**
3. 選擇 **OpenAI Chat Model**
4. 設定 System Prompt：
   ```
   你是一個郵件分類專家。
   分析郵件內容，判斷郵件的重要性和類別。
   考慮因素：發件人、主題、內容、時間敏感性
   ```

### 步驟三：設定 Text Classifier
1. 加入 **Text Classifier** 節點
2. 連接 **AI Agent** 到 **Text Classifier**
3. 定義分類類別：
   - 重要緊急
   - 重要一般
   - 一般資訊
   - 垃圾郵件
4. 設定分類規則（可選）

### 步驟四：設定條件分流
1. 加入 **IF** 節點
2. 根據分類結果設定條件：
   - 重要緊急 → 立即通知
   - 重要一般 → 記錄並通知
   - 一般資訊 → 僅記錄
   - 垃圾郵件 → 標記為垃圾

### 步驟五：記錄到 Google Sheets
1. 加入 **Google Sheets** 節點
2. 設定 Google Sheets 憑證
3. 選擇或建立試算表
4. 設定欄位對應：
   - 日期時間
   - 發件人
   - 主題
   - 分類結果
   - 優先級

### 步驟六：發送通知（選用）
1. 加入 **Gmail** 節點
2. 設定收件人（例如：自己或團隊）
3. 設定郵件內容：
   ```
   收到重要郵件：
   發件人：{{ $json.from }}
   主題：{{ $json.subject }}
   分類：{{ $json.category }}
   優先級：{{ $json.priority }}
   ```

### 步驟七：測試系統
1. 啟用工作流程
2. 發送測試郵件
3. 觀察分類結果和記錄

## 💡 實際應用場景

- **郵件管理**：自動分類和優先級排序
- **客服系統**：自動分類客戶問題
- **訂單處理**：自動識別訂單郵件
- **通知管理**：過濾重要通知
- **垃圾郵件過濾**：自動識別和處理垃圾郵件

## 🔧 進階功能擴展

### 練習 1：加入自動回覆
對於某些類別的郵件自動回覆：
- 收到訂單確認 → 自動回覆確認信
- 收到常見問題 → 自動回覆 FAQ

### 練習 2：學習優化
記錄分類準確性：
- 讓用戶標記分類是否正確
- 使用這些資料優化 Prompt
- 建立分類準確性報表

### 練習 3：多標籤分類
支援多標籤分類：
- 一個郵件可以有多個標籤
- 例如：重要 + 客戶 + 訂單

### 練習 4：整合其他服務
擴展功能：
- 重要郵件 → 發送到 Slack
- 訂單郵件 → 建立 CRM 記錄
- 客戶問題 → 建立工單

## 📌 常見問題

### Q: 分類不準確怎麼辦？
**A**: 
- 優化 System Prompt，提供更多範例
- 調整分類類別定義
- 使用更強大的模型（GPT-4）
- 加入人工審核機制

### Q: 如何處理大量郵件？
**A**: 
- 設定郵件篩選條件，只處理特定郵件
- 使用批次處理
- 監控執行時間和成本
- 考慮使用專用的郵件處理服務

### Q: 如何保護隱私？
**A**: 
- 確保 Gmail 憑證安全
- 不要記錄敏感資訊
- 遵守資料保護法規
- 定期清理記錄

## 📚 相關資源

- [n8n Gmail 節點文件](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.gmail/)
- [n8n Google Sheets 節點文件](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.googlesheets/)
- [Prompt Engineering 指南](https://platform.openai.com/docs/guides/prompt-engineering)

---

**🎓 完成此範例後，您將理解如何將 AI 應用到實際業務場景，建立自動化分類系統！**

